--
-- PostgreSQL database dump
--

truncate table password;
truncate table stamp;

-- Dumped from database version 15.10 (Debian 15.10-0+deb12u1)
-- Dumped by pg_dump version 15.12

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: graph_data(integer, date); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.graph_data(p_id integer, base_date date) RETURNS TABLE(waking integer, stamp_ymd text, stamp_hms text)
    LANGUAGE plpgsql
    AS $$
BEGIN
	RETURN QUERY
	select
	    stamp.WAKING,
	    TO_CHAR(stamp.TIME, 'YYYY-MM-DD'),
	    TO_CHAR(stamp.TIME, 'HH24:MI:SS')
	from
	    stamp
	where
	    stamp.ID = p_id AND
	    stamp.TIME BETWEEN
	    	base_date - interval '1 week' + interval '1 day' AND
	    	base_date + interval '1 day'
	order by
	    stamp.TIME asc;
END;
$$;


ALTER FUNCTION public.graph_data(p_id integer, base_date date) OWNER TO postgres;

--
-- Name: graph_data_m(integer, date); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.graph_data_m(p_id integer, base_date date) RETURNS TABLE(waking integer, stamp_ymd text, stamp_hms text)
    LANGUAGE plpgsql
    AS $$
BEGIN
	RETURN QUERY
	select
	    stamp.WAKING,
	    TO_CHAR(stamp.TIME, 'YYYY-MM-DD'),
	    TO_CHAR(stamp.TIME, 'HH24:MI:SS')
	from
	    stamp
	where
	    stamp.ID = p_id AND
	    stamp.TIME BETWEEN
	    	base_date - interval '1 month' + interval '1 day' AND
	    	base_date + interval '1 day'
	order by
	    stamp.TIME asc;
END;
$$;


ALTER FUNCTION public.graph_data_m(p_id integer, base_date date) OWNER TO postgres;

--
-- Name: totalling(integer); Type: FUNCTION; Schema: public; Owner: natura
--

CREATE FUNCTION public.totalling(p_id integer) RETURNS TABLE(id integer, waking integer, stamp_time text, delta interval)
    LANGUAGE plpgsql
    AS $$
BEGIN
    RETURN QUERY
	select
		STARTt.ID,
		STARTt.WAKING,
		TO_CHAR(STARTt.TIME, 'YYYY-MM-DD HH24:MI:SS'),
		ENDt.TIME - STARTt.TIME
	from (
		select
			stamp.ID,
			stamp.WAKING,
			TO_CHAR(stamp.TIME, 'YYYY-MM-DD HH24:MI:SS'),
			stamp.TIME,
			ROW_NUMBER() OVER(order by TIME desc) as row
		from
			stamp
		where
			stamp.ID = p_id
		order by stamp.TIME desc
	) as STARTt
	left outer join (
		select
			stamp.ID,
			stamp.WAKING,
			TO_CHAR(stamp.TIME, 'YYYY-MM-DD HH24:MI:SS'),
			stamp.TIME,
			ROW_NUMBER() OVER(order by TIME desc) as row
		from
			stamp
		where
			stamp.ID = p_id
		order by stamp.TIME desc
	) as ENDt on STARTt.row - 1 = ENDt.row;
END;
$$;


ALTER FUNCTION public.totalling(p_id integer) OWNER TO natura;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: password; Type: TABLE; Schema: public; Owner: natura
--

CREATE TABLE public.password (
    id integer NOT NULL,
    password character varying NOT NULL
);


ALTER TABLE public.password OWNER TO natura;

--
-- Name: stamp; Type: TABLE; Schema: public; Owner: natura
--

CREATE TABLE public.stamp (
    id integer,
    waking integer,
    "time" timestamp without time zone
);


ALTER TABLE public.stamp OWNER TO natura;

--
-- Data for Name: password; Type: TABLE DATA; Schema: public; Owner: natura
--

COPY public.password (id, password) FROM stdin;
1	9095ea2fe1b7d969ef71a9c01551ecf248ec7b91674cbf63c7d327707408137d637284ec23a3e95beedb27f690d4b4ff0f9b5922eac09d966d3497d916bd3332
21650	45119105597f95bee34743e2daa6ddbf5cdc954d8e0f83c5aeeb02ee76fb3ec366bfc2d0f7e22eb94a930a633c9751185664be4ff8acbb3f23596b8ebf429114
5353	6193f04257dce27b962c623da4f9db4d2c98dee299b3e2b38a9cf2aa229ceefc40cac65f36e902b646f743792947bf6e9b7a6ac53eab0f1bac69c7c1ae39d9ea
999	4fcfd9010619e20c3f94a00d90503ea807bc0cb95c590fdfc6386af60531d16f7ce7473a5d06aff5ec0998895c66d53ce2d570479f94286c90f15d318b9cd992
\.


--
-- Data for Name: stamp; Type: TABLE DATA; Schema: public; Owner: natura
--

COPY public.stamp (id, waking, "time") FROM stdin;
1	1	2025-02-16 16:12:01.621997
1	0	2025-02-16 17:22:03.723012
1	1	2025-02-16 21:44:14.986604
1	0	2025-02-17 06:13:12.685174
1	1	2025-02-18 00:05:04.375972
1	0	2025-02-18 06:18:24.102227
1	1	2025-02-18 21:18:28.925555
1	0	2025-02-19 05:57:41.454742
1	1	2025-02-19 21:00:07.199843
1	0	2025-02-20 07:40:19.323445
1	1	2025-02-20 23:13:35.207789
1	0	2025-02-21 05:23:51.860239
1	0	2025-02-22 06:42:59.464276
1	1	2025-02-21 20:30:00
1	1	2025-02-22 12:31:43.789292
1	0	2025-02-22 16:43:49.701637
1	1	2025-02-23 00:30:30.021493
1	0	2025-02-23 04:48:02.122408
21650	0	2025-02-23 07:55:54.328796
21650	0	2025-02-23 08:02:52.385181
21650	1	2025-02-23 08:03:02.742463
21650	0	2025-02-23 10:59:11.990833
5353	1	2025-02-23 11:00:10.245089
5353	0	2025-02-23 11:00:15.956238
1	1	2025-02-23 17:15:56.334761
1	0	2025-02-23 20:51:48.063643
1	1	2025-02-24 02:39:38.023984
1	0	2025-02-24 08:14:27.054656
1	1	2025-02-24 15:50:26.24493
1	0	2025-02-24 18:47:01.466182
1	1	2025-02-24 23:25:00.467754
1	0	2025-02-25 06:00:48.016891
1	1	2025-02-25 22:26:14.504039
21650	1	2025-02-26 00:02:19.563887
1	0	2025-02-26 01:55:59.777006
1	1	2025-02-26 02:07:12.276634
1	0	2025-02-26 06:00:29.299121
21650	0	2025-02-26 07:16:22.649792
21650	0	2025-02-26 07:16:31.719433
21650	1	2025-02-26 07:35:47.60416
21650	0	2025-02-26 09:27:37.685951
21650	0	2025-02-26 20:52:41.817836
1	0	2025-02-27 05:04:46.201618
1	1	2025-02-26 20:51:42.359173
999	1	2025-02-27 06:57:09.00467
999	0	2025-02-27 06:57:12.006937
999	0	2025-02-27 07:18:39.6209
999	1	2025-02-27 07:18:41.990356
999	0	2025-02-27 07:18:43.968783
999	1	2025-02-27 07:18:45.830105
999	0	2025-02-27 07:18:49.593541
999	1	2025-02-27 07:18:51.781839
21650	0	2025-02-27 07:48:46.064208
999	1	2025-02-27 19:56:05.208002
999	0	2025-02-27 19:56:07.661191
999	1	2025-02-27 20:05:46.578599
999	0	2025-02-27 20:05:53.655629
1	1	2025-02-27 21:51:43.696776
1	0	2025-02-28 04:20:56.818438
21650	0	2025-02-28 06:26:31.632787
21650	0	2025-02-28 06:26:34.673934
1	1	2025-02-28 20:01:12.347694
21650	0	2025-02-28 23:21:47.390895
21650	1	2025-02-28 23:21:53.803461
1	0	2025-03-01 02:56:19.383273
21650	0	2025-03-01 07:55:17.493548
999	1	2025-03-01 13:41:26.726911
999	0	2025-03-01 13:41:59.688084
1	1	2025-03-01 14:24:38.000285
1	0	2025-03-01 17:41:44.588078
21650	1	2025-03-01 23:30:18.067044
1	1	2025-03-02 01:50:01.390738
1	0	2025-03-02 06:45:23.431688
21650	0	2025-03-02 07:48:33.11009
999	1	2025-03-02 17:52:12.956485
999	0	2025-03-02 17:52:35.213214
999	1	2025-03-02 17:59:10.124676
999	0	2025-03-02 17:59:18.549985
1	1	2025-03-02 22:33:39.73098
1	0	2025-03-03 06:29:08.034573
21650	0	2025-03-03 08:30:15.855328
1	1	2025-03-03 22:54:32.766133
21650	1	2025-03-04 00:43:38.783025
1	0	2025-03-04 04:54:59.55095
21650	0	2025-03-04 07:35:04.98029
21650	0	2025-03-04 09:11:40.313577
1	0	2025-03-05 05:30:36.425325
1	1	2025-03-04 20:54:00
21650	0	2025-03-05 08:42:48.91516
1	1	2025-03-05 23:34:03.540187
1	0	2025-03-06 05:31:31.145113
21650	0	2025-03-06 07:42:05.854862
1	1	2025-03-06 20:45:44.98523
1	0	2025-03-07 02:56:00.637316
1	1	2025-03-07 03:52:49.181504
1	0	2025-03-07 06:23:41.998997
1	1	2025-03-07 20:20:38.579991
1	0	2025-03-08 02:53:07.594876
1	0	2025-03-08 16:29:48.08482
1	1	2025-03-08 13:40:49.146018
1	1	2025-03-08 21:26:27.042339
1	0	2025-03-09 01:17:54.708773
1	1	2025-03-09 02:21:32.214359
1	0	2025-03-09 06:39:26.125622
21650	1	2025-03-09 06:54:41.33686
21650	1	2025-03-09 06:54:42.807836
21650	0	2025-03-09 09:22:36.169703
1	1	2025-03-09 15:24:57.695502
1	0	2025-03-09 20:46:11.34556
1	1	2025-03-09 21:02:53.019689
1	0	2025-03-10 04:06:58.69635
21650	0	2025-03-10 07:40:53.169666
1	1	2025-03-10 21:20:08.297987
1	0	2025-03-11 02:22:11.527529
21650	0	2025-03-11 08:03:36.262027
1	1	2025-03-11 20:54:37.141486
1	0	2025-03-12 04:33:25.854973
21650	0	2025-03-12 08:23:51.772658
21650	0	2025-03-12 08:24:04.253376
21650	0	2025-03-12 08:24:08.460845
1	1	2025-03-12 22:06:14.799974
1	0	2025-03-13 05:17:03.682072
1	0	2025-03-14 03:54:17.062627
1	1	2025-03-13 21:02:30.434492
1	0	2025-03-14 17:52:10.299697
1	1	2025-03-14 11:54:10.751684
1	1	2025-03-14 23:50:04.464624
1	0	2025-03-15 06:32:41.330877
999	1	2025-03-15 07:57:12.154414
999	0	2025-03-15 07:57:20.164569
21650	0	2025-03-15 08:30:31.206771
1	0	2025-03-15 16:10:39.78248
1	1	2025-03-15 09:58:44.869412
1	1	2025-03-15 22:08:57.746477
1	0	2025-03-16 06:06:57.318602
21650	0	2025-03-16 08:18:28.036636
1	0	2025-03-16 17:19:10.272951
1	1	2025-03-16 11:32:53.32033
1	1	2025-03-16 23:36:56.874522
1	0	2025-03-17 04:49:14.231756
21650	0	2025-03-17 08:36:27.188305
1	1	2025-03-17 21:09:24.616468
1	0	2025-03-18 05:30:27.774453
1	1	2025-03-18 20:09:12.070135
1	0	2025-03-19 05:32:10.633213
21650	0	2025-03-19 07:22:40.340138
1	1	2025-03-19 22:01:38.776774
1	0	2025-03-20 05:36:48.774374
21650	0	2025-03-20 07:06:07.069226
21650	0	2025-03-20 07:06:08.564246
1	1	2025-03-20 09:19:18.988775
1	0	2025-03-20 13:46:05.920769
1	1	2025-03-20 23:37:11.885687
1	0	2025-03-21 06:46:16.973195
21650	0	2025-03-21 07:24:32.092061
1	1	2025-03-21 20:48:04.200775
1	0	2025-03-21 22:20:34.538
1	1	2025-03-21 23:45:03.365388
1	0	2025-03-22 07:04:19.228666
21650	0	2025-03-22 09:24:18.212019
1	1	2025-03-22 13:10:40.249403
1	0	2025-03-22 18:11:30.999803
1	1	2025-03-23 00:10:06.710456
1	0	2025-03-23 06:28:34.765398
21650	0	2025-03-23 09:35:45.28936
1	0	2025-03-23 17:02:16.283886
1	1	2025-03-23 13:32:53.125454
1	1	2025-03-23 23:24:43.73931
1	0	2025-03-24 06:32:14.787902
21650	0	2025-03-24 08:49:41.02131
1	1	2025-03-24 20:28:56.408998
1	0	2025-03-25 06:00:28.583055
21650	0	2025-03-25 08:00:19.946817
1	1	2025-03-25 23:02:55.541083
21650	0	2025-03-26 09:23:21.101355
1	1	2025-03-26 21:29:54.804442
1	0	2025-03-27 05:43:07.758253
1	0	2025-03-26 05:32:24.514346
21650	0	2025-03-27 07:50:50.796548
1	1	2025-03-27 23:08:04.389581
1	0	2025-03-28 07:35:36.985044
21650	0	2025-03-28 07:40:27.47682
1	0	2025-03-29 07:44:08.326115
1	1	2025-03-28 22:58:23.267444
1	1	2025-03-30 01:39:32.628643
1	0	2025-03-30 06:01:24.909785
1	1	2025-03-30 13:48:25.951076
1	0	2025-03-30 19:34:50.766074
1	1	2025-03-30 23:32:37.325807
1	0	2025-03-31 06:07:17.12946
21650	0	2025-03-31 07:50:38.831088
1	1	2025-03-31 23:25:25.523672
1	0	2025-04-01 05:29:27.439521
1	1	2025-04-01 22:30:07.1551
1	0	2025-04-02 06:28:33.369702
1	0	2025-04-03 06:31:17.004073
1	1	2025-04-02 22:58:54.876936
1	1	2025-04-03 21:07:25.520369
1	0	2025-04-04 05:37:36.20994
1	1	2025-04-04 22:34:20.141037
1	0	2025-04-05 05:44:54.935181
1	1	2025-04-05 23:42:17.771191
1	0	2025-04-06 05:17:39.614151
1	0	2025-04-06 21:25:58.11868
1	1	2025-04-06 18:34:02.935758
1	0	2025-04-07 06:00:56.35353
1	1	2025-04-07 00:11:23.68706
1	1	2025-04-07 23:30:26.153965
1	0	2025-04-08 05:33:05.954603
1	1	2025-04-08 20:33:16.847925
1	0	2025-04-09 05:01:51.459316
21650	0	2025-04-09 07:30:45.111588
1	1	2025-04-09 20:15:34.970625
1	0	2025-04-10 00:30:44.201239
1	0	2025-04-10 06:00:27.508179
21650	0	2025-04-10 08:05:28.90762
1	1	2025-04-10 21:49:56.758226
1	0	2025-04-11 05:03:12.32326
21650	0	2025-04-11 07:09:55.142404
21650	0	2025-04-11 09:23:22.466004
1	1	2025-04-11 20:33:00.838018
\.


--
-- PostgreSQL database dump complete
--

